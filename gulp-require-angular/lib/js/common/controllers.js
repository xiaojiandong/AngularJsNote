define(["base","services"],function(n,e){var t=angular.module("routerCtrls",["routerServices"]);t.controller("HomeCtrl",["$rootScope","$scope","allStudentsInfo",function(n,e,t){n.students=t.info,n.singleStudentInfo=t.info[0],n.arrIndex,n.classInfos=t.classInfo,n.classDetails=t.info,n.classType="1"}]),t.controller("topbarCtrl",["$scope","SUBJFac",function(n,e){n.tobarItems=[{sref:"index",text:"首页"},{sref:"index.usermng.allstudents",text:"班级管理"},{sref:"index.score",text:"成绩管理"},{sref:"index.signup",text:"学生注册"},{sref:"index.userInfo",text:"个人中心"}],e.topBarInit(),n.activeIndex=0,n.onTopNavClick=function(t){n.activeIndex=t,e.selectTopBarActive(t)}}]),t.controller("UserMngCtrl",["$rootScope","$scope","$state","allStudentsInfo",function(n,e,t,o){e.currentIndex=0,e.uiSrefs=[{url:"allstudents",word:"全部学生"},{url:"allclass",word:"全部班级"},{url:"honorlist",word:"光荣榜(>550)"},{url:"blacklist",word:"补考名单(<400)"}],e.setUiSrefClick=function(n){e.currentIndex=n},e.addUserType=function(){t.go("index.usermng.addusertype")},e.clickedIndex,e.currentUserInfo,e.onEditClick=function(s){e.clickedIndex=s.$index,n.editStudentsInfo=o.info[e.clickedIndex],t.go("index.usermng.detail")}}]),t.controller("allUsersCtrl",function(n,e){n.names=e.userInfo}),t.controller("classCtrl",["$rootScope","$scope","$state","allStudentsInfo","SUBJFac",function(n,e,t,o,s){var c=s.countClassTeacherAndStudentsNum(o);angular.forEach(c,function(e,t){n.classInfos[t].studentNum=e}),e.onClassDetailClick=function(e){var o=parseInt(e.classType)-1,s=n.classInfos[o].studentNum;0==s?$.confirm({title:e.name+" 班没人了",icon:"glyphicon glyphicon-heart",content:"确定还要进去吗?",confirmButtonClass:"btn-info",cancelButtonClass:"btn-success",confirmButton:"下一步有惊喜",cancelButton:"取消",cancel:function(){},confirm:function(){$.alert({title:"班级详情",content:"跳转到班级详情页面",confirmButtonClass:"btn-success",confirmButton:"好的再下一步",onAction:function(){n.classType=e.classType,t.go("index.usermng.classdetail")}})}}):(n.classType=e.classType,t.go("index.usermng.classdetail"))}}]),t.controller("classDetailCtrl",["$rootScope","$scope","$state","allStudentsInfo",function(n,e,t,o){e.hasStudent=!0,e.classLocalInfo={};var s=Number(n.classType)-1;e.classLocalInfo.name=o.classInfo[s].name,e.classLocalInfo.teacher=o.classInfo[s].teacher,0==n.classInfos[s].studentNum?(e.hasStudent=!1,$.alert({title:e.classLocalInfo.name+" 的悲哀",icon:"glyphicon glyphicon-heart",content:e.classLocalInfo.teacher+" 你们班木有学生了",confirmButtonClass:"btn-info",confirm:function(){$.alert({title:e.classLocalInfo.name+"和"+e.classLocalInfo.teacher+" 需要你",content:"跳转到学生注册页面",confirmButtonClass:"btn-success",onAction:function(){setTimeout(function(){t.go("index.signup")},100)}})}})):e.classTypefilter=function(e){return e.classType==n.classType?e:void 0},e.onReturnClassListClick=function(){t.go("index.usermng.allclass")}}]),t.controller("detailUsersCtrl",["$rootScope","$scope","$state","allStudentsInfo","SUBJFac",function(n,e,t,o,s){"undefined"!=n.editStudentsInfo&&null!=n.editStudentsInfo||(n.editStudentsInfo=o.info[0]),e.onReturnBackClick=function(){t.go("index.usermng.allstudents")},e.onReturnSignUpClick=function(){t.go("index.signup"),s.selectTopBarActive(3)}}]),t.controller("honorCtrl",["$scope","allStudentsInfo",function(n,e){n.honorFilter=function(n){return n.totalScore>550}}]),t.controller("blackCtrl",["$scope",function(n){n.blackFilter=function(n){return n.totalScore<400}}]),t.controller("scoreCtrl",["$rootScope","$scope","$state","allStudentsInfo","SUBJFac",function(n,e,t,o,s){e.word="高->低 降序",e.flag=!0,e.colName="name",e.birthDay="birthday",e.desc=1,e.scoreOrder="totalScore",e.onOrderCheckClick=function(){e.flag=!e.flag,e.flag?(e.word="高->低 降序",e.desc=1):(e.word="低->高 升序",e.desc=0)},e.onEditClick=function(e,s){e.index;n.arrIndex=s,n.singleStudentInfo=o.info[n.arrIndex],t.go("index.edit")}}]),t.controller("editCtrl",["$rootScope","$scope","$state","allStudentsInfo","SUBJFac",function(n,e,t,o,s){$(".popover-hide").popover("hide"),null!=n.arrIndex&&"undefined"!=n.arrIndex||(n.arrIndex=0),e.editInfo={},e.editInfo.score=o.info[n.arrIndex].totalScore,e.editInfo.name=o.info[n.arrIndex].name,e.editInfo.no=o.info[n.arrIndex].no,e.editInfo.className=o.info[n.arrIndex].className,e.classes=[{className:"高三(1)班",teacher:"吴老师"},{className:"高三(2)班",teacher:"刘老师"},{className:"高三(3)班",teacher:"薛老师"},{className:"高三(4)班",teacher:"孔老师"}],e.editInfo.selectedClass,e.editInfo.birthday=o.info[n.arrIndex].birthday,e.editInfo.nativePlace=o.info[n.arrIndex].nativePlace,e.editInfo.tel=o.info[n.arrIndex].tel,e.isShowInitClass=!0,e.onChangeClassOption=function(){e.isShowInitClass=!1},e.selectClassNameTeacherType=function(){var t,s,c;e.isShowInitClass?(t=o.info[n.arrIndex].className,s=o.info[n.arrIndex].teacher,c=o.info[n.arrIndex].classType):(t=e.editInfo.selectedClass,"高三(1)班"==t&&(s="吴老师",c="1"),"高三(2)班"==t&&(s="刘老师",c="2"),"高三(3)班"==t&&(s="薛老师",c="3"),"高三(4)班"==t&&(s="孔老师",c="4")),n.singleStudentInfo.className=t,n.singleStudentInfo.classType=c,n.singleStudentInfo.teacher=s},e.onScoreBlur=function(){return e.editInfo.score>750||e.editInfo.score<0?($.alert({title:"你输入的 "+e.editInfo.score+" 分不正确",icon:"glyphicon glyphicon-heart",content:"分数必须在[0,750]之间",confirmButtonClass:"btn-info",confirm:function(){$(".js_score_edit").focus()}}),!1):void 0},e.onSubmitInfoClick=function(){n.singleStudentInfo.totalScore=e.editInfo.score,n.singleStudentInfo.name=e.editInfo.name,n.singleStudentInfo.no=e.editInfo.no,n.singleStudentInfo.birthday=e.editInfo.birthday,n.singleStudentInfo.nativePlace=e.editInfo.nativePlace,n.singleStudentInfo.tel=e.editInfo.tel,e.selectClassNameTeacherType();var t=s.countClassTeacherAndStudentsNum(o);angular.forEach(t,function(e,t){n.classInfos[t].studentNum=e}),$.alert({title:e.editInfo.name,icon:"glyphicon glyphicon-heart",content:"信息修改成功!",confirmButtonClass:"btn-info",onAction:function(){setTimeout(function(){},500)}})},e.hasDeleted=!1,e.onResetInfoClick=function(){e.editInfo.score=o.info[n.arrIndex].totalScore,e.editInfo.name=o.info[n.arrIndex].name,e.editInfo.no=o.info[n.arrIndex].no,e.editInfo.birthday=o.info[n.arrIndex].birthday,e.editInfo.nativePlace=o.info[n.arrIndex].nativePlace,e.editInfo.tel=o.info[n.arrIndex].tel,e.editInfo.selectedClass=o.info[n.arrIndex].className,e.editInfo.teacher=o.info[n.arrIndex].teacher,$.alert({title:"已恢复到上一级修改的状态",confirmButtonClass:"btn-success",content:!1,animationBounce:1.5})},e.onReturnScoreClick=function(){t.go("index.score")};var c=0;e.onDeleteInfoClick=function(){if(e.hasDeleted=!0,c+=1,1==c){var s=o.info[n.arrIndex].name;o.info.splice(n.arrIndex,1),n.students=o.info,$.alert({title:"删除提示",confirmButtonClass:"btn-success",content:s+" 已成功删除!",animationBounce:1.5,onAction:function(n){var e="<div class='col-md-12'><img src='http://pic.uuhy.com/uploads/2011/08/01/github.jpg' style='width: 100%' /></div>";$(".js_edit_wrap_top").html(e),$(".button-wrap").before("<br/><br/><br/><br/>")}})}else $.alert({title:"重复删除，无效",confirmButtonClass:"btn-success",content:"该用户已删除不能再删，返回成绩管理",animationBounce:1.5,onAction:function(n){setTimeout(function(){t.go("index.score")},100)}})}}]),t.controller("signupCtrl",["$rootScope","$scope","$state","allStudentsInfo","SUBJFac",function(n,e,t,o,s){e.signUpInfo={},e.signUpInfo.totalScore="",e.signUpInfo.name="",e.signUpInfo.sex="男",e.signUpInfo.no="",e.signUpInfo.className="高三(1)班",e.signUpInfo.teacher,e.signUpInfo.birthday="",e.signUpInfo.nativePlace="",e.signUpInfo.tel="",e.signUpInfo.classType,e.signUpInfo.index="2",e.signUpInfo.avatar="http://www.qq1234.org/uploads/allimg/150113/1AI02408-17.jpg",e.selectClassTypeAndTeacher=function(){"高三(1)班"==e.signUpInfo.className?(e.signUpInfo.teacher="吴老师",e.signUpInfo.classType="1"):"高三(2)班"==e.signUpInfo.className?(e.signUpInfo.teacher="刘老师",e.signUpInfo.classType="2"):"高三(3)班"==e.signUpInfo.className?(e.signUpInfo.teacher="薛老师",e.signUpInfo.classType="3"):(e.signUpInfo.teacher="孔老师",e.signUpInfo.classType="4")},e.isShowBar=!1,e.scoreAlertFn=function(n,e){$.alert({title:n.title,confirmButtonClass:"btn-success",content:n.content,animationBounce:1.5,onAction:function(n){e&&null!=e&&e()}})},e.saveFormClick=function(){var c={};if(""==e.signUpInfo.totalScore)c.title="1. 分数",c.content="请填写分数",e.scoreAlertFn(c);else if(""==e.signUpInfo.name)c.title="2. 姓名",c.content="请填写姓名",e.scoreAlertFn(c);else if(""==e.signUpInfo.no)c.title="4. 学号",c.content="请填写学号",e.scoreAlertFn(c);else if(""==e.signUpInfo.birthday)c.title="5. 生日",c.content="请填写生日",e.scoreAlertFn(c);else if(""==e.signUpInfo.nativePlace)c.title="6. 籍贯",c.content="请填写籍贯",e.scoreAlertFn(c);else if(""==e.signUpInfo.tel)c.title="7. 电话",c.content="请填写电话",e.scoreAlertFn(c);else{e.selectClassTypeAndTeacher(),e.isShowBar=!e.isShowBar,o.info.push(e.signUpInfo);var i=s.countClassTeacherAndStudentsNum(o);angular.forEach(i,function(e,t){n.classInfos[t].studentNum=e}),e.alertProgressBarSuccessBackFn=function(){$.alert({title:e.signUpInfo.name+" 成功注册",confirmButtonClass:"btn-success",content:"该用户已经成功注册",animationBounce:1.5,confirm:function(){e.isShowBar=!e.isShowBar,$.alert({title:"跳转页面",confirmButtonClass:"btn-info",content:"进入学生详情页面",animationBounce:1.5,onAction:function(e){setTimeout(function(){"undefined"!=n.editStudentsInfo&&null!=n.editStudentsInfo||(n.editStudentsInfo=o.info[o.info.length-1]),t.go("index.usermng.detail"),s.selectTopBarActive(1)},50)}})}})};var a=20,l=setInterval(function(){a+=30,$(".js_bar_len").css({width:a+"%"}),a>=100&&(clearInterval(l),setTimeout(function(){e.alertProgressBarSuccessBackFn()},1100))},100)}},e.onBlurScore=function(){e.callBackFn=function(){setTimeout(function(){e.signUpInfo.totalScore="",$(".js_score_inp").focus()},100)};var n={};""==e.signUpInfo.totalScore?(n.title="分数tip1",n.content="并没有输入分数，请重输",e.scoreAlertFn(n,e.callBackFn)):e.signUpInfo.totalScore<0?(n.title="分数tip2",n.content="分数小于0分，重修",e.scoreAlertFn(n,e.callBackFn)):e.signUpInfo.totalScore>750&&(n.title="分数tip3",n.content="超过满分750了，你可以上常青藤，不科学",e.scoreAlertFn(n,e.callBackFn))},e.returnScoreListClick=function(){t.go("index.score"),s.selectTopBarActive(2)},e.returnClassListClick=function(){t.go("index.usermng.allstudents"),s.selectTopBarActive(1)}}])});